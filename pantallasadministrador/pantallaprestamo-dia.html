<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pr√©stamos-D√≠a</title>
  <link rel="stylesheet" href="../styles.css/styles.css">
  <script src="../callrestapi.js"></script>

</head>

<body>
  <div class="contenedor">
    <img src="../img/logo.png" alt="Logo" class="logo" />

    <div class="usuario">
      <div class="foto-perfil" id="fotoPerfil"></div>
      <span id="nombreAdmin">Administrador</span>
    </div>

    <h2>Pr√©stamos-D√≠a</h2>

    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Fecha</th>
          <th>Hora Pr√©stamo</th>
          <th>Hora Entrega</th>
          <th>Art√≠culo</th>
          <th>Cantidad</th>
        </tr>
      </thead>
      <tbody id="tablaPrestamos">
        <tr>
          <td>Pedro R.</td>
          <td>27/04/2025</td>
          <td>11:00-12:00</td>
          <td>12:00-12:30</td>
          <td>Bal√≥n</td>
          <td>2</td>
          <td><button class="btn-eliminar">Eliminar</button></td>
        </tr>
      </tbody>
    </table>

    <button class="btn-eliminar-todo" onclick="confirmarBorrado()">Borrar todo</button>

    <div class="casita">
      <img src="../img/iconocasa.png" alt="Inicio" onclick="irAlInicio()" />
    </div>
  </div>
 
<script>
  const BASE_URL = "https://prestamosback-zfcp.onrender.com"; // porque no se hereda del otro js

  const contenedor = document.getElementById("fotoPerfil");
  const imagenPerfil = localStorage.getItem("fotoPerfilAdmin");
  if (imagenPerfil) {
    contenedor.style.backgroundImage = `url('${imagenPerfil}')`;
  }

  const nombre = localStorage.getItem("nombreAdmin");
  if (nombre) {
    document.getElementById("nombreAdmin").textContent = nombre;
  }

  function confirmarBorrado() {
    if (confirm("¬øDeseas borrar todos los registros del d√≠a?")) {
      document.getElementById("tablaPrestamos").innerHTML = "";
    }
  }

  function irAlInicio() {
    window.location.href = "menuadministrador.html"; // CORREGIDO
  }

  const idAdmin = localStorage.getItem("idAdmin");

  async function cargarPrestamosDelDia() {
    try {
      console.log("üß† idAdmin en localStorage:", idAdmin);
      const res = await fetch(`${BASE_URL}/api/prestamos/dia/${idAdmin}`);
      if (!res.ok) throw new Error("Error al cargar pr√©stamos");
      const data = await res.json();

      const tabla = document.getElementById("tablaPrestamos");
      tabla.innerHTML = "";

      data.forEach(p => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td>${p.nombre_alumno}</td>
          <td>${p.fecha}</td>
          <td>${p.hora_inicio}</td>
          <td>${p.hora_fin}</td>
          <td>${p.nombre_articulo}</td>
          <td>${p.cantidad}</td>
          <td><button onclick="eliminarPrestamo(${p.id_prestamo}, this)">Eliminar</button></td>
        `;
        tabla.appendChild(fila);
      });
    } catch (err) {
      console.error("‚ùå No se pudieron cargar los pr√©stamos del d√≠a:", err);
    }
  }

  async function eliminarPrestamo(id, boton) {
    if (!confirm("¬øEliminar este pr√©stamo?")) return;

    const res = await fetch(`${BASE_URL}/api/prestamos/${id}`, {
      method: "DELETE"
    });

    if (res.ok) {
      boton.closest("tr").remove();
    } else {
      alert("Error al eliminar el pr√©stamo.");
    }
  }

  cargarPrestamosDelDia();
</script>


</body>

</html>
