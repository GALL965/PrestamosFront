<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Disponibilidad Administradores</title>
  <link rel="stylesheet" href="../styles.css/styles.css" />
</head>

<body>
  <div class="menu">
    <img src="../img/logo.png" alt="Logo" class="logo" />

    <div class="usuario">
      <div class="foto-perfil" id="fotoPerfil"></div>
      <span id="nombreAlumno">Estudiante</span>
    </div>

    <h2>Disponibilidad de Administradores</h2>

    <label for="adminSelect">Selecciona un administrador:</label>
    <select id="adminSelect">
      <option value="">-- Seleccionar --</option>
      <option value="ricardo">Ricardo Gómez</option>
      <option value="maria">María López</option>
    </select>

    <table id="tablaDisponibilidad">
      <thead>
        <tr>
          <th>Horarios</th>
          <th>Lunes</th>
          <th>Martes</th>
          <th>Miércoles</th>
          <th>Jueves</th>
          <th>Viernes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>08:00-09:00</td>
          <td></td><td></td><td></td><td></td><td></td>
        </tr>
        <tr>
          <td>10:00-11:00</td>
          <td></td><td></td><td></td><td></td><td></td>
        </tr>
      </tbody>
    </table>

    <div style="text-align: center; margin-top: 20px;">
      <a href="menualumno.html">
        <img src="../img/iconocasa.png" alt="Inicio" style="width: 40px; height: 40px;" />
      </a>
    </div>
  </div>
    
<script>
const BASE_URL = "https://prestamosback-zfcp.onrender.com";

document.addEventListener("DOMContentLoaded", async () => {
  const select = document.getElementById("adminSelect");
  const tabla = document.getElementById("tablaDisponibilidad").getElementsByTagName("tbody")[0];

  // Paso 1: Cargar administradores
  try {
    const res = await fetch(`${BASE_URL}/api/usuarios/admins`);
    const admins = await res.json();

    admins.forEach(admin => {
      const option = document.createElement("option");
      option.value = admin.id;
      option.textContent = admin.nombre;
      select.appendChild(option);
    });
  } catch (err) {
    console.error("Error al cargar administradores:", err);
    alert("Error al cargar administradores");
  }

  // Paso 2: Manejar selección
  select.addEventListener("change", async () => {
    const idAdmin = select.value;

    // Limpiar tabla
    [...tabla.rows].forEach(row => {
      for (let i = 1; i <= 5; i++) {
        row.cells[i].textContent = "";
      }
    });

    if (!idAdmin) return;

    try {
      const res = await fetch(`${BASE_URL}/api/disponibilidad/${idAdmin}`);
      const disponibilidad = await res.json();

      // Mapear la disponibilidad a una estructura organizada
      const diasSemana = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes"];
      const horariosMap = {};

      disponibilidad
        .filter(d => d.disponible === 1)
        .forEach(d => {
          if (!horariosMap[d.horario]) {
            horariosMap[d.horario] = { Lunes: "", Martes: "", Miércoles: "", Jueves: "", Viernes: "" };
          }
          horariosMap[d.horario][d.dia] = "✔";
        });

      // Reconstruir tabla
      tabla.innerHTML = "";
      Object.entries(horariosMap).forEach(([horario, dias]) => {
        const fila = document.createElement("tr");
        const celdaHorario = document.createElement("td");
        celdaHorario.textContent = horario;
        fila.appendChild(celdaHorario);

        diasSemana.forEach(dia => {
          const celda = document.createElement("td");
          celda.textContent = dias[dia] || "";
          fila.appendChild(celda);
        });

        tabla.appendChild(fila);
      });

    } catch (err) {
      console.error("Error al cargar disponibilidad:", err);
      alert("Error al cargar disponibilidad");
    }
  });
});
</script>

</body>

</html>
